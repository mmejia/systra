// Generated by CoffeeScript 1.6.3
define(['infracciones/ManagerArticulosServParticularInf', 'infracciones/ManagerRecojeDocumentoInf', 'infracciones/ManagerDatosInfractorServParticularInf', 'infracciones/ManagerCaracteristicasVehiculoServParticularInf', 'infracciones/ManagerDatosLicenciaServParticularInf', 'infracciones/ManagerCertificadoMedicoServParticularInf', 'infracciones/ManagerTipoServicioPublicoInf', 'infracciones/ManagerMenuMain', 'infracciones/ManagerSelPuntoGoogleViewInf', 'core/sandbox'], function(articulos, documentos, datosInfractor, caracteristicasVehiculos, datosLicencia, certificadoMedico, tipoServicioPublico, mod_manager_menu, sel_punto, sandbox) {
  var ManagerServicioParticlarInf;
  return ManagerServicioParticlarInf = {
    padreId: "#ManagerServicioParticular",
    elementId: "#ServicioParticularInf",
    element: null,
    template: null,
    padre: null,
    observaciones: null,
    delegacion: null,
    rad_servicio_particular: null,
    rad_servicio_publico: null,
    rad_taxi: null,
    rad_urbano: null,
    rad_foraneo: null,
    rad_policia: null,
    rad_transito: null,
    iniciar: function() {
      var that;
      that = this;
      this.padre = $(this.padreId);
      this.sandbox = new sandbox(this);
      this.observaciones = $("#observaciones_inf").wysihtml5();
      this.sandbox.on('limpiar-observaciones', this.limpiarObservaciones);
      this.sandbox.on('llenar-observaciones', this.llenarObservaciones);
      this.sandbox.on('cargar-infraccion-en-view', that.llenarInfraccion);
      this.delegacion = $('#delegacion_spa_inf');
      this.delegacion.on('change', function(evento) {
        var valor;
        valor = $('#' + evento.currentTarget.id).val();
        window.actualizarComandanciaValor(valor);
      });
      this.rad_servicio_particular = document.getElementById("radioServicioParticular");
      this.rad_servicio_publico = document.getElementById("radioServicioPublico");
      this.rad_taxi = document.getElementById("rd_taxi_spa_inf");
      this.rad_urbano = document.getElementById("rd_urbano_spa_inf");
      this.rad_foraneo = document.getElementById("rd_foraneo_spa_inf");
      this.rad_policia = document.getElementById("rd_policia_spa_inf(");
      this.rad_transito = document.getElementById("rd_transito_spa_inf");
      $('#folio_infraccion').change(function(evento) {
        var disp, disponibles, p, val, _i, _j, _len, _len1, _ref;
        disponibles = $(this).autocomplete("option", "source");
        val = $(this).val();
        for (_i = 0, _len = disponibles.length; _i < _len; _i++) {
          disp = disponibles[_i];
          if ("" + disp.label === "" + val) {
            _ref = window.profiles;
            for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
              p = _ref[_j];
              if (p) {
                if ("" + p.cobro === "" + disp.folio_agente) {
                  $("#nom-cobro-agente-inf").val(p.cobro);
                  $("#nombre-agente-inf").val(p.nombre);
                  $("#delegacion_spa_inf").val(p.delegacion);
                  $("#comandancia_spa_inf").val(p.comandancia);
                  $("#turno_spa_inf").val(p.turno);
                  return;
                }
              }
            }
          }
        }
      });
      articulos.iniciar();
      documentos.iniciar();
      datosInfractor.iniciar();
      caracteristicasVehiculos.iniciar();
      certificadoMedico.iniciar();
      tipoServicioPublico.iniciar();
      sel_punto.iniciar();
      mod_manager_menu.iniciar();
      if (!window.infraccion) {
        this.llenarFoliosDisponibles();
        this.llenarProfiles();
        this.llenarDelegaciones();
        this.llenarTurnos();
        this.llenarColonias();
        this.llenarCalles();
        this.llenarOperativos();
        this.llenarCirculaciones();
      } else {
        $.when($.ajax("/catalogos/delegaciones.json"), $.ajax("/catalogos/comandancias.json"), $.ajax("/catalogos/turnos.json"), $.ajax("/catalogos/colonias.json"), $.ajax("/catalogos/calles.json"), $.ajax("/catalogos/operativos.json"), $.ajax("/catalogos/circulaciones.json")).done(function(delegaciones, comandancias, turnos, colonias, calles, operativos, circulaciones) {
          window.delegaciones = delegaciones[0];
          window.comandancias = comandancias[0];
          window.turnos = turnos[0];
          window.colonias = colonias[0];
          window.calles = calles[0];
          window.operativos = operativos[0];
          window.circulaciones = circulaciones[0];
          that.llenarProfiles();
          that.llenarDelegaciones();
          that.llenarTurnos();
          that.llenarColonias();
          that.llenarCalles();
          that.llenarOperativos();
          that.llenarCirculaciones();
          return that.llenarInfraccion();
        });
      }
      $('#myTab a').click(function(e) {
        e.preventDefault();
        return $(this).tab('show');
      });
      this.delegacion.on('change', function(evento) {
        var valor;
        valor = $('#' + evento.currentTarget.id).val();
        window.actualizarComandanciaValor(valor);
      });
    },
    llenarFoliosDisponibles: function() {
      $.ajax({
        type: 'GET',
        url: '/folios/folios_disponibles',
        success: function(data) {
          var collection, item, _i, _len;
          collection = [];
          for (_i = 0, _len = data.length; _i < _len; _i++) {
            item = data[_i];
            collection.push(item);
          }
          return $("#folio_infraccion").autocomplete({
            source: collection,
            change: function(evento, ui) {
              var p, _j, _len1, _ref, _results;
              _ref = window.profiles;
              _results = [];
              for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
                p = _ref[_j];
                if (p) {
                  if (p.cobro === ui.item.folio_agente) {
                    $("#nom-cobro-agente-inf").val(p.cobro);
                    $("#nombre-agente-inf").val(p.nombre);
                    $("#delegacion_spa_inf").val(p.delegacion);
                    $("#comandancia_spa_inf").val(p.comandancia);
                    _results.push($("#turno_spa_inf").val(p.turno));
                  } else {
                    _results.push(void 0);
                  }
                } else {
                  _results.push(void 0);
                }
              }
              return _results;
            }
          });
        }
      });
    },
    cancelar: function() {
      $('#folio_infraccion').val('');
      $('#nombre-agente-inf').val('');
      $('#nom-cobro-agente-inf').val('');
      $('#optServicioParticular').attr("checked", false);
      $('#delegacion_spa_inf').val('');
      $('#comandancia_spa_inf').val('');
      $('#turno_spa_inf').val('');
      $('#colonia_spa_inf').val('');
      $('#calle1_spa_inf').val('');
      $('#calle2_spa_inf').val('');
      $('#referencia_spa_inf').val('');
      $('#lat_inf').val('');
      $('#lng_inf').val('');
      $('#tipo_operativo_spa_inf').val('');
      this.sandbox.emit('limpiar-articulos');
      this.sandbox.emit('limpiar-recoje');
      this.sandbox.emit('limpiar-infractor');
      this.sandbox.emit('limpiar-caracteristicas-vehiculo');
      this.sandbox.emit('limpiar-certificado-medico');
      $('#si_firmo_inf').attr("checked", false);
      $('#no_firmo_inf').attr("checked", false);
      return this.limpiarObservaciones();
    },
    limpiarObservaciones: function() {
      var w5ref;
      w5ref = this.observaciones.data('wysihtml5');
      if (w5ref) {
        w5ref.editor.clear();
      } else {
        this.observaciones.html('');
      }
    },
    reiniciarInfraccion: function() {
      window.infraccion = {};
      window.infraccion.articulos = [];
      window.infraccion.se_recoje = [];
      window.infractor = {};
      window.vehiculo = {};
      return window.certificado = {};
    },
    agregarInfraccion: function() {
      var inf;
      inf = window.infraccion;
      inf.folio_infraccion = $('#folio_infraccion').val();
      inf.nombreAgente = $('#nombre-agente-inf').val();
      inf.noCobro = $('#nom-cobro-agente-inf').val();
      if (this.rad_servicio_particular.checked === true) {
        this.rad_servicio_particular.checked = true;
        inf.tipo_servicio = "Servicio Particular";
      } else if (this.rad_servicio_publico === true) {
        inf.tipo_servicio = "Servicio Publico";
        if (this.rad_taxi.checked === true) {
          inf.tipo_publico = "Taxi";
        }
        if (this.rad_urbano.checked === true) {
          inf.tipo_publico = "Urbano";
        }
        if (this.rad_foraneo.checked === true) {
          inf.tipo_publico = "Foráneo";
        }
        if (this.rad_policia.checked === true) {
          inf.tipo_publico = "Policía";
        }
        if (this.rad_transito.checked === true) {
          inf.tipo_publico = "Tránsito";
        }
      } else {
        inf.tipo_servicio = "Servicio Particular";
      }
      inf.fecha = $('#fecha_inf').val();
      inf.hora = $('#hora_inf').val();
      inf.delegacion = $('#delegacion_spa_inf').val();
      inf.comandancia = $('#comandancia_spa_inf').val();
      inf.turno = $('#turno_spa_inf').val();
      inf.colonia = $('#colonia_spa_inf').val();
      inf.calle1 = $('#calle1_spa_inf').val();
      inf.calle2 = $('#calle2_spa_inf').val();
      inf.referencia = $('#referencia_spa_inf').val();
      inf.latitud = $('#lat_inf').val();
      inf.longitud = $('#lng_inf').val();
      inf.tipo_operativo = $('#tipo_operativo_spa_inf').val();
      this.sandbox.emit('llenar-infraccion-articulos');
      this.sandbox.emit('llenar-infraccion-recoje');
      this.sandbox.emit('llenar-infraccion-infractor');
      this.sandbox.emit('llenar-infraccion-caracteristicas-vehiculo');
      this.sandbox.emit('llenar-infraccion-certificado-medico');
      if ($('#si_firmo_inf').is(':checked')) {
        inf.firmo = "si";
      } else {
        inf.firmo = "no";
      }
      this.llenarInfraccionObservaciones();
      $.post('/infraccion/crear', inf, function(data) {});
      this.cancelar();
      console.log(inf);
    },
    llenarInfraccionObservaciones: function() {
      var infraccion, w5ref;
      infraccion = window.infraccion;
      w5ref = this.observaciones.data('wysihtml5');
      if (w5ref) {
        infraccion.observaciones = w5ref.editor.getValue();
      } else {
        infraccion.observaciones = this.element.html();
      }
    },
    llenarInfraccion: function() {
      var inf;
      inf = window.infraccion;
      $('#folio_infraccion').val(inf.folio_infraccion);
      $('#nombre-agente-inf').val(inf.nombreAgente);
      $('#nom-cobro-agente-inf').val(inf.noCobro);
      if (inf.servicio === "Servicio Publico") {
        tipoServicioPublico.mostrar(true);
        this.rad_servicio_publico.checked = true;
        if (inf.tipo_servicio === "Taxi") {
          this.rad_taxi.checked = true;
        } else if (inf.tipo_servicio === "Urbano") {
          this.rad_urbano.checked = true;
        } else if (inf.tipo_servicio === "Foraneo") {
          this.rad_foraneo.checked = true;
        } else if (inf.tipo_servicio === "Policia") {
          this.rad_policia.checked = true;
        } else if (inf.tipo_servicio === "Transito") {
          this.rad_transito.checked = true;
        }
      } else {
        this.rad_servicio_particular.checked = true;
      }
      $('#fecha_inf').val(inf.fecha);
      $('#hora_inf').val(inf.hora);
      $('#delegacion_spa_inf').val(inf.delegacion);
      actualizarComandanciaValor(inf.delegacion);
      $('#comandancia_spa_inf').val(inf.comandancia);
      $('#turno_spa_inf').val(inf.turno);
      $('#colonia_spa_inf').val(inf.colonia);
      $('#calle1_spa_inf').val(inf.calle1);
      $('#calle2_spa_inf').val(inf.calle2);
      $('#referencia_spa_inf').val(inf.referencia);
      $('#lat_inf').val(inf.latitud);
      $('#lng_inf').val(inf.longitud);
      $('#tipo_operativo_spa_inf').val(inf.tipo_operativo);
      $('#circulacion_spa_inf').val(inf.circulacion);
      this.sandbox.emit('update-articulos', {
        contenido: infraccion.articulos
      });
      this.sandbox.emit('update-recoje');
      this.sandbox.emit('update-infractor');
      this.sandbox.emit('update-caracteristicas-vehiculo');
      this.sandbox.emit('update-certificado-medico');
      if (inf.firmo === 'si') {
        $('#si_firmo_inf').attr("checked", true);
      } else {
        $('#no_firmo_inf').attr("checked", true);
      }
      this.llenarObservaciones();
    },
    llenarObservaciones: function() {
      var infraccion, w5ref;
      infraccion = window.infraccion;
      w5ref = this.observaciones.data('wysihtml5');
      if (w5ref) {
        w5ref.editor.setValue(infraccion.observaciones);
      } else {
        this.element.html(infraccion.observaciones);
      }
    },
    showTipoServicioPubico: function(bol) {
      return console.log("Sabe llegar");
    },
    llenarDelegaciones: function() {
      var delegacion, opciones, sel, _i, _len, _ref;
      if (!window.delegaciones) {
        cargarDelegaciones(this.llenarDelegaciones);
      } else {
        sel = $("#delegacion_spa_inf").html("");
        opciones = '<option  value="NO">**SELECCIONAR**</option>';
        _ref = window.delegaciones;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          delegacion = _ref[_i];
          opciones += '<option value="' + delegacion.delegacion + '">' + delegacion.delegacion + '</option>';
        }
        sel.append(opciones);
      }
      window.actualizarComandancia();
    },
    llenarComandancias: function() {
      var comandancia, opciones, sel, _i, _len, _ref;
      if (!window.comandancias) {
        cargarComandancias(this.llenarComandancias);
      } else {
        sel = $("#comandancia_spa_inf").html("");
        opciones = '<option  value="NO">**SELECCIONAR**</option>';
        _ref = window.comandancias;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          comandancia = _ref[_i];
          opciones += '<option value="' + comandancia.comandancia + '">' + comandancia.comandancia + '</option>';
        }
        sel.append(opciones);
      }
    },
    llenarTurnos: function() {
      var opciones, sel, turno, _i, _len, _ref;
      if (!window.turnos) {
        cargarTurnos(this.llenarTurnos);
      } else {
        sel = $("#turno_spa_inf").html("");
        opciones = '<option  value="NO">**SELECCIONAR**</option>';
        _ref = window.turnos;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          turno = _ref[_i];
          opciones += '<option value="' + turno.turno + '">' + turno.turno + '</option>';
        }
        sel.append(opciones);
      }
    },
    llenarColonias: function() {
      var item, nombres, _i, _len, _ref;
      if (!window.colonias) {
        cargarColonias(this.llenarColonias);
      } else {
        nombres = [];
        _ref = window.colonias;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          item = _ref[_i];
          nombres.push(item.nombre);
        }
        $("#colonia_spa_inf").autocomplete({
          source: nombres
        });
      }
    },
    llenarProfiles: function() {
      var agente, agentes, list_cobro, that, _i, _len;
      that = this;
      if (!window.profiles) {
        cargarProfiles(this.llenarProfiles);
      } else {
        list_cobro = [];
        agentes = window.profiles;
        for (_i = 0, _len = agentes.length; _i < _len; _i++) {
          agente = agentes[_i];
          list_cobro.push(agente.cobro);
        }
        $("#nom-cobro-agente-inf").autocomplete({
          source: list_cobro,
          change: function(evento, ui) {
            var p, _j, _len1, _ref, _results;
            _ref = window.profiles;
            _results = [];
            for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
              p = _ref[_j];
              if (p) {
                if (p.cobro === ui.item.value) {
                  $("#nombre-agente-inf").val(p.nombre);
                  $("#delegacion_spa_inf").val(p.delegacion);
                  $("#comandancia_spa_inf").val(p.comandancia);
                  _results.push($("#turno_spa_inf").val(p.turno));
                } else {
                  _results.push(void 0);
                }
              } else {
                _results.push(void 0);
              }
            }
            return _results;
          }
        });
      }
    },
    actualizarAgente: function() {
      return console.log("Oscuridad ");
    },
    llenarCalles: function() {
      var item, nombres, _i, _len, _ref;
      if (!window.calles) {
        cargarCalles(this.llenarCalles);
      } else {
        nombres = [];
        _ref = window.calles;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          item = _ref[_i];
          nombres.push(item.calle);
        }
        $("#calle1_spa_inf").autocomplete({
          source: nombres
        });
        $("#calle2_spa_inf").autocomplete({
          source: nombres
        });
      }
    },
    llenarOperativos: function() {
      var opciones, operativo, sel, _i, _len, _ref;
      if (!window.operativos) {
        cargarOperativos(this.llenarOperativos);
      } else {
        sel = $("#tipo_operativo_spa_inf").html("");
        opciones = '<option  value="NO">**SELECCIONAR**</option>';
        _ref = window.operativos;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          operativo = _ref[_i];
          opciones += '<option value="' + operativo.descripcion + '">' + operativo.descripcion + '</option>';
        }
        sel.append(opciones);
      }
    },
    llenarCirculaciones: function() {
      var circulacion, opciones, sel, _i, _len, _ref;
      if (!window.circulaciones) {
        cargarCirculaciones(this.llenarCirculaciones);
      } else {
        sel = $("#circulacion_spa_inf").html("");
        opciones = '<option  value="NO">**SELECCIONAR**</option>';
        _ref = window.circulaciones;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          circulacion = _ref[_i];
          opciones += '<option value="' + circulacion.circulacion + '">' + circulacion.circulacion + '</option>';
        }
        sel.append(opciones);
      }
    }
  };
});
