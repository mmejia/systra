// Generated by CoffeeScript 1.6.3
define(['core/sandbox', 'infracciones/BasicOperations'], function(sandbox, bo) {
  var app;
  return app = {
    tabla: null,
    bo: null,
    isBuscar: true,
    iniciar: function() {
      var that;
      that = this;
      this.bo = bo;
      this.sandbox = new sandbox(this);
      $(".editar-infraccion").on('click', function(evento) {
        var her, id, ident;
        ident = evento.currentTarget.id;
        her = ident.split('_');
        id = her[1];
        that.ocultarLista();
        return that.showCaptura(id);
      });
      that.llenarDisponibles();
      that.iniciarCalendario();
      $('#add-field-search').on('click', function(evento) {
        return that.appendSearchField();
      });
      $("#show-search").on('click', function(evento) {
        if (that.isBuscar === true) {
          that.isBuscar = false;
          return that.ocultarBuscar();
        } else {
          that.isBuscar = true;
          return that.mostrarBuscar();
        }
      });
      $('.view-infraccion').on('click', function(evento) {
        var her, id, ident;
        ident = evento.currentTarget.id;
        her = ident.split('_');
        id = her[1];
        return that.showViewInfraccion(id);
      });
      $('.print-infraccion').on('click', function(evento) {
        var her, id, ident;
        ident = evento.currentTarget.id;
        her = ident.split('_');
        id = her[1];
        return that.showPdfInfraccion(id);
      });
      $('#exportarPdf').on('click', function(evento) {
        return that.showPdfListInfraccion();
      });
      $('.remove-infraccion').on('click', function(evento) {
        var her, id, ident;
        ident = evento.currentTarget.id;
        her = ident.split('_');
        id = her[1];
        return that.removeInfraccion(id);
      });
      $("#buscarInfracciones").on('click', function(evento) {
        return $("#page").val('');
      });
      $(".url-nav").on('click', function(evento) {
        var id;
        id = evento.currentTarget.id;
        return that.preDo(id);
      });
      $("#exportarExcel").on('click', function(evento) {
        evento.preventDefault();
        $("#frm-search-infracciones").attr('action', '/infraccion/excel').submit();
        return $("#frm-search-infracciones").attr('action', '/infraccion/list');
      });
      return that.ordenar_head();
    },
    preDo: function(id) {
      $("#page").val(id);
      return $("#frm-search-infracciones").submit();
    },
    ordenar_head: function() {
      $("#ordenar_folio_asc").on('click', function(evento) {
        $("#order_by").val("folio");
        $("#order_tipo").val("asc");
        return $("#frm-search-infracciones").submit();
      });
      $("#ordenar_folio_desc").on('click', function(evento) {
        $("#order_by").val("folio");
        $("#order_tipo").val("desc");
        return $("#frm-search-infracciones").submit();
      });
      $("#ordenar_delegacion_asc").on('click', function(evento) {
        $("#order_by").val("delegacion");
        $("#order_tipo").val("asc");
        return $("#frm-search-infracciones").submit();
      });
      $("#ordenar_delegacion_desc").on('click', function(evento) {
        $("#order_by").val("delegacion");
        $("#order_tipo").val("desc");
        return $("#frm-search-infracciones").submit();
      });
      $("#ordenar_comandancia_asc").on('click', function(evento) {
        $("#order_by").val("comandancia");
        $("#order_tipo").val("asc");
        return $("#frm-search-infracciones").submit();
      });
      $("#ordenar_comandancia_desc").on('click', function(evento) {
        $("#order_by").val("comandancia");
        $("#order_tipo").val("desc");
        return $("#frm-search-infracciones").submit();
      });
      $("#ordenar_fecha_infrac_asc").on('click', function(evento) {
        $("#order_by").val("fecha_infrac");
        $("#order_tipo").val("asc");
        return $("#frm-search-infracciones").submit();
      });
      $("#ordenar_fecha_infrac_desc").on('click', function(evento) {
        $("#order_by").val("fecha_infrac");
        $("#order_tipo").val("desc");
        return $("#frm-search-infracciones").submit();
      });
      $("#ordenar_motivo_asc").on('click', function(evento) {
        $("#order_by").val("motivo");
        $("#order_tipo").val("asc");
        return $("#frm-search-infracciones").submit();
      });
      $("#ordenar_motivo_desc").on('click', function(evento) {
        $("#order_by").val("motivo");
        $("#order_tipo").val("desc");
        return $("#frm-search-infracciones").submit();
      });
      $("#ordenar_servicio_asc").on('click', function(evento) {
        $("#order_by").val("servicio");
        $("#order_tipo").val("asc");
        return $("#frm-search-infracciones").submit();
      });
      $("#ordenar_servicio_desc").on('click', function(evento) {
        $("#order_by").val("servicio");
        $("#order_tipo").val("desc");
        return $("#frm-search-infracciones").submit();
      });
    },
    ocultarBuscar: function() {
      var cambios, el;
      $("#show-search").html('<i class="icosystra-zoom-in"></i>');
      el = $("#div-search");
      cambios = {
        height: "0px",
        width: "auto",
        margin: "0 0 0 0",
        padding: "0",
        overflow: "hidden",
        transition: "all 2s ease"
      };
      return el.css(cambios);
    },
    mostrarBuscar: function() {
      var cambios, el;
      $("#show-search").html('<i class="icosystra-zoom-out"></i>');
      el = $("#div-search");
      cambios = {
        height: "auto",
        width: "98%",
        margin: "0 10px 0 10px",
        transition: "all 4s ease"
      };
      return el.css(cambios);
    },
    removeInfraccion: function(folio) {
      var that;
      that = this;
      $.ajax({
        type: "GET",
        url: '/infraccion/removeInfraccion/' + folio + '/',
        dataType: 'json',
        success: function(res) {
          return $("#frm-search-infracciones").submit();
        },
        error: function(error) {
          console.log(error);
          return that.showMensajeError(error.responseText);
        }
      });
    },
    showPdfInfraccion: function(id_unico) {
      var that;
      that = this;
      that.iniciarSpiner();
      $.ajax({
        type: "GET",
        url: '/infraccion/ventana_reporte_infraccion_from_id/' + id_unico + '/',
        dataType: 'html',
        success: function(res) {
          that.showMensaje("INFRACCIÃ“N ", res);
          return window.spinner.stop();
        },
        error: function(error) {
          that.showMensajeError(error.responseText);
          return window.spinner.stop();
        }
      });
    },
    showPdfListInfraccion: function() {
      var that;
      that = this;
      that.iniciarSpiner();
      $.ajax({
        type: "GET",
        url: '/infraccion/pdf_list/',
        data: $("#frm-search-infracciones").serialize(),
        dataType: 'html',
        success: function(res) {
          that.showMensaje("INFORME ", res);
          return window.spinner.stop();
        },
        error: function(error) {
          that.showMensajeError(error.responseText);
          return window.spinner.stop();
        }
      });
    },
    iniciarSpiner: function() {
      var opts, target;
      opts = {
        lines: 13,
        length: 20,
        width: 10,
        radius: 30,
        corners: 1,
        rotate: 0,
        direction: 1,
        color: '#000',
        speed: 1,
        trail: 60,
        shadow: false,
        hwaccel: false,
        className: 'spinner',
        zIndex: 2e9,
        top: 'auto',
        left: 'auto'
      };
      target = document.getElementById('loading');
      window.spinner = new Spinner(opts).spin(target);
      return target.appendChild(window.spinner.el);
    },
    showViewInfraccion: function(id) {
      var that;
      that = this;
      that.iniciarSpiner();
      $.ajax({
        type: "GET",
        url: '/infraccion/viewInfraccion/' + id + '/',
        dataType: 'html',
        success: function(res) {
          that.showMensaje("INFRACCION ", res, that.llenarViewInfraccion);
          return window.spinner.stop();
        },
        error: function(error) {
          console.log(error);
          window.spinner.stop();
          return that.showMensajeError(error.responseText);
        }
      });
    },
    llenarViewInfraccion: function() {
      var inf, rd_foraneo, rd_policia, rd_taxi, rd_transito, rd_urbano, that;
      that = this;
      if (window.view_infraccion) {
        inf = window.view_infraccion;
        $('#view_folio_infraccion').html(inf.folio_infraccion);
        if (inf.nombreAgente === 'None') {
          $('#view_nombre-agente-inf').html("");
        } else {
          $('#view_nombre-agente-inf').html(inf.nombreAgente);
        }
        $('#view_nom-cobro-agente-inf').html(inf.noCobro);
        rd_taxi = document.getElementById("view_rd_taxi_spa_inf");
        rd_urbano = document.getElementById("view_rd_urbano_spa_inf");
        rd_foraneo = document.getElementById("view_rd_foraneo_spa_inf");
        rd_policia = document.getElementById("view_rd_policia_spa_inf");
        rd_transito = document.getElementById("view_rd_transito_spa_inf");
        $('#view_fecha_inf').html(inf.fecha);
        $('#view_hora_inf').html(inf.hora);
        $('#view_delegacion_spa_inf').html(inf.delegacion);
        $('#view_comandancia_spa_inf').html(inf.comandancia);
        $('#view_turno_spa_inf').html(inf.turno);
        $('#view_colonia_spa_inf').html(inf.colonia);
        $('#view_calle1_spa_inf').html(inf.calle1);
        $('#view_calle2_spa_inf').html(inf.calle2);
        $('#view_referencia_spa_inf').html(inf.referencia);
        $('#view_lat_inf').html(inf.latitud);
        $('#view_lng_inf').html(inf.longitud);
        $('#view_tipo_operativo_spa_inf').html(inf.tipo_operativo);
        $('#view_circulacion_spa_inf').html(inf.circulacion);
        onlyViewRecoje();
        onlyViewArticulos();
        onlyViewInfractor();
        onlyViewCaracteristicasVehiculo();
        viewOnlyCertificadoMedico();
        if (inf.firmo === 'si') {
          $('#si_firmo_inf').click();
        } else {
          $('#no_firmo_inf').click();
        }
        return viewOnlyObservaciones();
      }
    },
    showMensajeError: function(msg) {
      var $div;
      $div = $('#myErrorModal .modal-body').html(msg);
      $("#myErrorModal").modal('show');
      return $('#myErrorModalLabel').html('ERROR');
    },
    showMensaje: function(titulo, msg, fn, sandbox) {
      var $div;
      $div = $('#myModal .modal-body').html(msg);
      $("#myModal").modal('show');
      $('#myModalLabel').html(titulo);
      if (fn) {
        fn(sandbox);
        return window.spinner.stop();
      }
    },
    appendSearchField: function() {
      var $search, div, inp, label, seleccionado;
      seleccionado = $('#campos').val();
      div = $('<div class="span4"></div>');
      label = '<label>' + seleccionado + '</label>';
      inp = '<input id="' + seleccionado + '" name="' + seleccionado + '" type="text">';
      div.append(label);
      div.append(inp);
      $search = $('#search-append');
      $search.append(div);
      return this.quitarDisponible(seleccionado);
    },
    quitarDisponible: function(campo) {
      var disponible, i, _i, _len, _ref;
      _ref = window.disponibles_json;
      for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
        disponible = _ref[i];
        if (disponible === campo) {
          window.disponibles_json.splice(i, 1);
        }
      }
      return this.llenarDisponibles();
    },
    llenarDisponibles: function() {
      var disponible, opciones, sel, _i, _len, _ref;
      sel = $('#campos').empty();
      if (window.disponibles_json) {
        opciones = '<option  value="NO">**SELECCIONAR**</option>';
        _ref = window.disponibles_json;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          disponible = _ref[_i];
          opciones += '<option value="' + disponible + '">' + disponible + '</option>';
        }
        return sel.append(opciones);
      }
    },
    ocultarLista: function() {
      var cambios, el;
      el = $("#pantalla-lista");
      cambios = {
        height: "0px",
        margin: "0 0 0 0",
        padding: "0",
        width: "auto",
        overflow: "hidden",
        transition: "all 4s ease"
      };
      return el.css(cambios);
    },
    iniciarCalendario: function() {
      $('#fecha-inicia-append').datetimepicker({
        pickTime: false,
        language: 'es'
      });
      return $('#fecha-final-append').datetimepicker({
        pickTime: false,
        language: 'es'
      });
    },
    showCaptura: function(id) {
      var cambios, el, gg, that;
      that = this;
      gg = $.get('/infraccion/solo_captura_infraccion/' + id + '/', function(data) {
        $(".pantalla-captura").html(data);
        that.bo.iniciar();
        window.cargarSelects(that.bo);
        return $('#mostrar-captura-preliminar').on('click', function() {
          return that.ocultarLista();
        });
      });
      gg.fail(function() {
        return alert('Error');
      });
      el = $(".pantalla-captura");
      cambios = {
        height: "auto",
        width: "98%",
        margin: "0 10px 0 10px",
        transition: "all 4s ease"
      };
      return el.css(cambios);
    },
    cargarInfracciones: function() {
      var that;
      that = this;
      return $.ajax({
        type: 'GET',
        url: 'listInfracciones.json',
        success: function(data) {
          var articulo, articulos, item, nom_articulo, _i, _j, _len, _len1, _results;
          _results = [];
          for (_i = 0, _len = data.length; _i < _len; _i++) {
            item = data[_i];
            articulos = item.articulos;
            nom_articulo = '';
            for (_j = 0, _len1 = articulos.length; _j < _len1; _j++) {
              articulo = articulos[_j];
              nom_articulo = articulo.ART + " " + articulo.FRACC + "/";
            }
            that.tabla.dataTable().fnAddData(['<a href="#" class="updateInfraccion" id="' + item.id + '"><i class="icon-pencil"></i></a>  ' + '<a href="#" class="viewInfraccion" id="' + item.id + '"><i class="icon-print"></i></a> ' + '<a href="#" class="deleteInfraccion" id="' + item.id + '"><i class="icon-remove"></i></a>', item.folio, item.delegacion, item.comandancia, item.fecha, nom_articulo, item.tipo_servicio]);
            $('#' + item.id).on('click', function(evento) {
              var id;
              id = evento.currentTarget.id;
              window.location.href = "cargarInfraccion/" + id + "/";
            });
            $('#' + item.id).on('click', function() {
              return console.log("Vamos a ver la infraccion");
            });
            _results.push($('#' + item.id).on('click', function() {
              return console.log("Vamos a Borrar el accidente");
            }));
          }
          return _results;
        }
      });
    },
    cargarAccidente: function() {}
  };
});
