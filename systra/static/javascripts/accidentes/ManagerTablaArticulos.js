// Generated by CoffeeScript 1.6.3
define(['../core/sandbox'], function(sandbox) {
  var app;
  return app = {
    sandbox: null,
    investigacion: null,
    iniciar: function(accidente) {
      this.sandbox = new sandbox(this);
      this.sandbox.on('refrescar-articulos-view', this.refrescarArticulos);
      this.sandbox.on('borrar-articulo-view', this.borrarArticulo);
      return this.sandbox.on('borrar-all-articulos-view', this.borrarAllArticulos);
    },
    borrarAllArticulos: function() {
      window.accidente.articulos = [];
      return this.refrescarArticulos();
    },
    agregarArticulo: function(articulo) {
      console.log(articulo);
      window.accidente.articulos.push(articulo);
      this.sandbox.emit('refrescar-articulos-view');
      return $('#articulos_pp').val('');
    },
    borrarArticulo: function(evento) {
      var articulo, borrar, clone, i, id, lista, _i, _j, _len, _len1;
      id = evento.target.id;
      lista = window.accidente.articulos;
      clone = [];
      clone = lista.slice(0);
      borrar = [];
      for (i = _i = 0, _len = clone.length; _i < _len; i = ++_i) {
        articulo = clone[i];
        if (articulo) {
          if ('' + articulo.id === '' + id) {
            borrar.push(i);
          }
        }
      }
      for (_j = 0, _len1 = borrar.length; _j < _len1; _j++) {
        i = borrar[_j];
        delete lista[i];
      }
      this.sandbox.emit('refrescar-articulos-view');
    },
    refrescarArticulos: function() {
      var articulo, row, tabla, that, _i, _len, _ref,
        _this = this;
      that = this;
      tabla = $("#tab_articulos_pp");
      $("#tab_articulos_pp>tbody").empty();
      console.log(window.accidente.articulos);
      _ref = window.accidente.articulos;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        articulo = _ref[_i];
        if (articulo) {
          row = "<tr>						<td><a href=\"#\" id=\"" + articulo.id + "\" class=\"borrar-articulo\"><i class='icon-edit'></i></td>						<td>" + articulo.art + "</td>						<td>" + articulo.fracc + "</td>						<td>" + articulo.descc + "</td>						</tr>";
          tabla.append(row);
        }
        $(".borrar-articulo").on('click', function(event) {
          return that.sandbox.emit('borrar-articulo-view', event);
        });
      }
    }
  };
});
