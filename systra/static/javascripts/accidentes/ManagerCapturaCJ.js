// Generated by CoffeeScript 1.6.3
define(['core/sandbox'], function(sandbox) {
  var CapturaCompetenciaJudicial;
  return CapturaCompetenciaJudicial = {
    btnAgregar: null,
    dialogo: null,
    iniciar: function() {
      var btnAgregar, btnCancelar, that;
      that = this;
      this.sandbox = new sandbox(this);
      this.sandbox.on('llenar-competencia-judicial-view', this.mostrarCompetenciaJudicialOnView);
      this.sandbox.on('agregar-competencia-judicial', this.actualizarCompetenciaJudicial);
      btnAgregar = $('#agregar_cj_pp');
      this.llenarAccEdoFisicos();
      this.llenarDetenidoEn();
      btnAgregar.on('click', function() {
        return that.showCapturaCompetenciaJudicial();
      });
      btnCancelar = $("#dialogo-cancelar-competencia-judicial");
      btnCancelar.on('click', function() {
        return that.cancelar();
      });
      btnAgregar = $('#dialogo-aceptar-competencia-judicial');
      btnAgregar.on('click', function() {
        return that.actualizarCompetenciaJudicial();
      });
      return $("#cargar-competencia-judicial").on('click', function(evento) {
        return that.mostrarCompetenciaJudicialOnView(0);
      });
    },
    showCapturaCompetenciaJudicial: function() {
      var cambios, cambiosTabla, el, tabla;
      el = $("#CapturaCompetenciaJudicialView");
      tabla = $("#tabla_competencia_judicial_view");
      cambios = {
        height: "auto",
        width: "100%"
      };
      el.css(cambios);
      cambiosTabla = {
        height: "0px",
        width: "0%"
      };
      return tabla.css(cambiosTabla);
    },
    mostrarCompetenciaJudicialOnView: function(id) {
      var accidente, competenciaJudicial, competenciasJudiciales;
      accidente = window.accidente;
      competenciasJudiciales = accidente.competenciaJudiciales;
      competenciaJudicial = competenciasJudiciales[id];
      $("#nombre_cj").val(competenciaJudicial.nombre);
      $('#estado_cj').val(competenciaJudicial.estado_herido);
      $("#edad_cj").val(competenciaJudicial.edad);
      $("#domicilio_cj").val(competenciaJudicial.domicilio);
      $("#detenidoen_cj").val(competenciaJudicial.detenido_en);
      $("#adisposicionde_cj").val(competenciaJudicial.disposicion);
      $("#seencontraba_cj").val(competenciaJudicial.se_encontraba);
      return this.showCapturaCompetenciaJudicial();
    },
    actualizarCompetenciaJudicial: function() {
      var accidente, competencia, competenciaJudicial, competenciaJudiciales, encontro, i, _i, _len;
      if (!this.validateField()) {
        return;
      }
      accidente = window.accidente;
      competenciaJudiciales = accidente.competenciaJudiciales;
      competenciaJudicial = {};
      competenciaJudicial.nombre = $("#nombre_cj").val();
      competenciaJudicial.estado_herido = $('#estado_cj').val();
      competenciaJudicial.edad = $("#edad_cj").val();
      competenciaJudicial.domicilio = $("#domicilio_cj").val();
      competenciaJudicial.detenido_en = $("#detenidoen_cj").val();
      competenciaJudicial.disposicion = $("#adisposicionde_cj").val();
      competenciaJudicial.se_encontraba = $("#seencontraba_cj").val();
      encontro = -1;
      for (i = _i = 0, _len = competenciaJudiciales.length; _i < _len; i = ++_i) {
        competencia = competenciaJudiciales[i];
        if (competencia.nombre + competencia.edad === competenciaJudicial.nombre + competenciaJudicial.edad) {
          encontro = i;
        }
      }
      if (encontro > -1) {
        competenciaJudiciales[encontro] = competenciaJudicial;
      } else {
        competenciaJudiciales.push(competenciaJudicial);
      }
      window.accidente.competenciaJudiciales = competenciaJudiciales;
      this.cancelar();
      return this.sandbox.emit('actualizar-tabla-competencia-judicial');
    },
    validateField: function() {
      var rr, val_edad;
      if ($("#nombre_cj").val() === '') {
        this.showFieldError($("#nombre_cj"), "Es necesario establecer El nombre");
        return false;
      } else {
        this.showFieldSuccess($("#nombre_cj"));
      }
      if ($('#estado_cj').val() === 'SEL') {
        this.showFieldError($("#estado_cj"), "Es necesario establecer El estado del  persona");
        return false;
      } else {
        this.showFieldSuccess($("#estado_cj"));
      }
      val_edad = $("#edad_cj").val();
      if ($("#edad_cj").val() === '') {
        this.showFieldError($("#edad_cj"), "Es necesario establecer La edad");
        return false;
      } else {
        rr = window.validateEdad(val_edad);
        if (!rr.res) {
          this.showFieldError($("#edad_cj"), rr.msg);
          return false;
        } else {
          this.showFieldSuccess($("#edad_cj"));
        }
      }
      if ($("#domicilio_cj").val() === '') {
        this.showFieldError($("#domicilio_cj"), "Es necesario establecer El domicilio");
        return false;
      } else {
        this.showFieldSuccess($("#domicilio_cj"));
      }
      if ($("#detenidoen_cj").val() === 'SEL') {
        this.showFieldError($("#detenidoen_cj"), "Es necesario establecer detenido en");
        return false;
      } else {
        this.showFieldSuccess($("#detenidoen_cj"));
      }
      if ($("#adisposicionde_cj").val() === 'SEL') {
        this.showFieldError($("#adisposicionde_cj"), "Es necesario establecer a disposición de");
        return false;
      } else {
        this.showFieldSuccess($("#adisposicionde_cj"));
      }
      if ($("#seencontraba_cj").val() === 'SEL') {
        this.showFieldError($("#seencontraba_cj"), "Es necesario establecer se encontraba");
        return false;
      } else {
        this.showFieldSuccess($("#seencontraba_cj"));
      }
      this.quitarClases();
      return true;
    },
    cancelar: function() {
      $("#nombre_cj").val('');
      $('#estado_cj').val('');
      $("#edad_cj").val('');
      $("#domicilio_cj").val('');
      $("#detenidoen_cj").val('');
      $("#adisposicionde_cj").val('');
      $("#seencontraba_cj").val('');
      return this.mostrarTabla();
    },
    quitarClases: function() {
      $(".cj").removeClass("success");
      return $(".cj").removeClass("error");
    },
    showFieldError: function(item, msg) {
      var padre;
      padre = item.parents("div.control-group");
      padre.addClass('error');
      padre.children('.help-inline').html(msg);
      return item.focus();
    },
    showFieldSuccess: function(item) {
      var padre;
      padre = item.parents("div.control-group");
      padre.addClass('success');
      return padre.children('.help-inline').html('');
    },
    mostrarTabla: function() {
      var cambios, cambiosTabla, el, tabla;
      el = $("#CapturaCompetenciaJudicialView");
      tabla = $("#tabla_competencia_judicial_view");
      cambios = {
        height: "0px",
        width: "0%"
      };
      el.css(cambios);
      cambiosTabla = {
        height: "auto",
        width: "100%"
      };
      return tabla.css(cambiosTabla);
    },
    llenarAccEdoFisicos: function() {
      var opciones, sel_ss;
      sel_ss = $("#estado_cj");
      opciones = '<option  value="SEL">**SELECCIONAR**</option>';
      opciones += '<option value="Detenido">Detenido</option>';
      opciones += '<option value="Lesionado y Detenido">Lesionado y Detenido</option>';
      opciones += '<option value="A Disposición">A Disposición</option>';
      opciones += '<option value="SE DESCONOCE">SE DESCONOCE</option>';
      sel_ss.append(opciones);
    },
    llenarDetenidoEn: function() {
      var detenido, opciones, sel, _i, _len, _ref;
      if (!window.tbDetenidos) {
        cargarTbDetenidos(this.llenarDetenidoEn);
      } else {
        sel = $("#detenidoen_cj");
        opciones = '<option  value="SEL">**SELECCIONAR**</option>';
        _ref = window.tbDetenidos;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          detenido = _ref[_i];
          opciones += '<option value="' + detenido.descripcion + '">' + detenido.descripcion + '</option>';
        }
        sel.append(opciones);
      }
    }
  };
});
