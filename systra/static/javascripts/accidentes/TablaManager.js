// Generated by CoffeeScript 1.6.3
define([], function() {
  var TablaManager;
  return TablaManager = {
    datos: null,
    indice: 0,
    offset: 5,
    tam: 0,
    current: 0,
    getDatos: function() {
      var that;
      that = this;
      return $.ajax({
        type: "GET",
        url: "/accidente/listarActivos",
        success: function(datos) {
          var dato, i, opc, _i, _ref, _ref1;
          that.datos = datos;
          that.tabla.children('tbody').empty();
          for (i = _i = _ref = that.indice, _ref1 = that.offset; _ref <= _ref1 ? _i <= _ref1 : _i >= _ref1; i = _ref <= _ref1 ? ++_i : --_i) {
            dato = datos[i];
            if (dato !== void 0) {
              opc = '<tr>';
              opc += '<td><a href="#" id="' + dato.id_unico + '"><i class="icon-ok-sign"></i></a> </td>';
              opc += '<td>' + dato.fecha_evento + '</td>';
              opc += '<td>' + dato.folio_evento + '</td>';
              opc += '<td>' + dato.agente_intervino + '</td>';
              opc += '<td>' + dato.calle1 + '</td>';
              opc += '</tr>';
              that.tabla.children('tbody').append(opc);
              that.registrarEvento(dato.id_unico);
            }
          }
          return that.actualizarPaginacion();
        }
      });
    },
    buscarActivos: function(id_unico) {
      var activo, _i, _len, _ref;
      if (this.datos) {
        _ref = this.datos;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          activo = _ref[_i];
          if (activo.id_unico === id_unico) {
            return activo;
          }
        }
      }
      return null;
    },
    registrarEvento: function(id_unico) {
      var that;
      that = this;
      return $('#' + id_unico).on('click', function(evento) {
        var accidente, id, preliminar;
        id = evento.currentTarget.id;
        preliminar = that.buscarActivos(id);
        if (preliminar !== null) {
          accidente = window.accidente;
          if (!accidente) {
            that.reiniciarAccidente();
          }
          accidente = window.accidente;
          accidente.id_unico = preliminar.id_unico;
          $("#folio_accidente").val(preliminar.folio_evento);
          $("#nombre_agente_intervino_pp").val(preliminar.agente_intervino);
          $("#delegacion_pp").val(preliminar.delegacion);
          window.actualizarComandanciaValor(preliminar.delegacion);
          $("#turno_pp").val(preliminar.turno);
          $("#fecha-fecha_pp").val(preliminar.fecha_evento);
          $("#hora-hora_pp").val(preliminar.hora_evento);
          $("#clasAccidente_pp").val(preliminar.id_clasificacion);
          $("#calle1_pp").val(preliminar.calle1);
          $("#calle2_pp").val(preliminar.calle2);
          $("#frente_num").val(preliminar.ref);
          $("#colonia_pp").val(preliminar.colonia);
          $("#estado_pp").val("GUANAJUATO");
          $("#municipio_pp").val("LEÃ“N");
          return that.ocultarSelPreliminar();
        } else {
          return that.ocultarSelPreliminar();
        }
      });
    },
    ocultarSelPreliminar: function() {
      var cambios, el;
      el = $("#sel-preliminar");
      cambios = {
        height: "0px",
        width: "0px"
      };
      return el.css(cambios);
    },
    reiniciarAccidente: function() {
      window.accidente = {};
      window.accidente.vehiculos = [];
      window.accidente.saldoSangres = [];
      window.accidente.intervino = {};
      window.accidente.superviso = {};
      window.accidente.fotos = [];
      window.accidente.croquis = '';
      window.accidente.observaciones = '';
      window.accidente.investigaciones = '';
      window.accidente.competenciaJudiciales = [];
      window.accidente.articulos = [];
      window.accidente.otros = {};
      window.accidente.estado_calles = {};
      window.accidente.danos = [];
      return window.accidente.simbologia_croquis = '';
    },
    actualizarTabla: function() {
      var dato, i, opc, that, _i, _ref, _ref1, _results;
      that = this;
      that.tabla.children('tbody').empty();
      console.log("El indice : " + that.indice + "  offset:  " + that.offset);
      _results = [];
      for (i = _i = _ref = that.indice, _ref1 = that.offset; _ref <= _ref1 ? _i <= _ref1 : _i >= _ref1; i = _ref <= _ref1 ? ++_i : --_i) {
        dato = that.datos[i];
        opc = '<tr>';
        opc += '<td><a href="#" id="' + dato.id_unico + '"><i class="icon-ok-sign"></i></a> </td>';
        opc += '<td>' + dato.fecha_evento + '</td>';
        opc += '<td>' + dato.folio_evento + '</td>';
        opc += '<td>' + dato.agente_intervino + '</td>';
        opc += '<td>' + dato.calle1 + '</td>';
        opc += '</tr>';
        that.tabla.children('tbody').append(opc);
        _results.push(that.registrarEvento(dato.id_unico));
      }
      return _results;
    },
    actualizarPaginacion: function() {
      var i, numero, pag, pos, residuo, tam, that, tmp, ul, _i;
      that = this;
      tam = that.datos.length;
      numero = tam / that.offset;
      residuo = tam % that.offset;
      pag = $("#paginacion-sel-preliminar");
      pag.html('');
      ul = $("<ul></ul>");
      pag.append(ul);
      ul.append('<li><a id="pag-sel-pre-previo" href="#">Prev</a></li>');
      $('#pag-sel-pre-previo').on('click', function(evento) {
        if (that.indice === 0) {
          that.indice = 0;
        } else {
          that.indice = that.indice - that.offset;
        }
        that.actualizarTabla();
        return that.desactivarLiga(ul, that.indice);
      });
      for (i = _i = 0; 0 <= numero ? _i <= numero : _i >= numero; i = 0 <= numero ? ++_i : --_i) {
        pos = i * that.offset;
        tmp = i + 1;
        if (pos === that.indice) {
          ul.append('<li class="disabled"><a id="pag-sel-pre--' + pos + '" href="#">' + tmp + '</a></li>');
        } else {
          ul.append('<li><a id="pag-sel-pre--' + pos + '" href="#">' + tmp + '</a></li>');
        }
        $('#pag-sel-pre--' + pos).on('click', function(evento) {
          var her, ident;
          ident = evento.currentTarget.id;
          her = ident.split('--');
          that.indice = her[1];
          that.actualizarTabla();
          return that.desactivarLiga(ul, that.indice);
        });
      }
      ul.append('<li ><a id="pag-sel-pre-next" href="#">Sig.</a></li>');
      return $('#pag-sel-pre-next').on('click', function(evento) {
        if (that.indice + that.offset < that.datos.length) {
          that.indice = that.indice + that.offset;
        }
        that.actualizarTabla();
        return that.desactivarLiga(ul, that.indice);
      });
    },
    desactivarLiga: function(ul, pos) {
      var indice, that;
      that = this;
      indice = pos / that.offset;
      indice = indice + 1;
      ul.children('li').removeClass('disabled');
      return ul.children('li:eq(' + indice + ')').addClass('disabled');
    },
    iniciar: function() {
      var that;
      return that = this;
    }
  };
});
