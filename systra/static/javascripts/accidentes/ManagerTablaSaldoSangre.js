// Generated by CoffeeScript 1.6.3
define(['core/sandbox'], function(sandbox) {
  var ManagerSaldoSangre;
  return ManagerSaldoSangre = {
    botonId: '#agregar_saldo_sangre',
    elementId: '#tabla_saldo_sangre_view',
    padreId: "#saldo-sangre",
    boton: null,
    element: null,
    padre: null,
    template: null,
    ocultarCSS: null,
    mostrarCSS: null,
    num_saldo: 0,
    iniciar: function() {
      var that;
      that = this;
      this.boton = $(this.botonId);
      this.sandbox = new sandbox(this);
      this.padre = $(this.padreId);
      this.element = $(this.elementId);
      this.sandbox.on('actualizar-tabla-saldo-sangre', this.actualizarTablaSaldoSangre);
      this.sandbox.on('vaciar-tabla-saldo-sangre', this.vaciarTabla);
      this.sandbox.on('cargar-saldo-sangre-view', this.cargarSaldoSangreEnView);
      if (window.accidente) {
        this.actualizarTablaSaldoSangre();
      }
    },
    vaciarTabla: function() {
      var tabla;
      tabla = $("#tab_saldo_sangre>tbody");
      return tabla.empty();
    },
    cargarSaldoSangreEnView: function() {
      return this.actualizarTablaSaldoSangre();
    },
    borrarSaldoSangre: function(evento) {
      var her, id, identificador, saldoSangres;
      identificador = evento.target.id;
      her = identificador.split('-');
      id = her[1];
      saldoSangres = window.accidente.saldoSangres;
      saldoSangres.splice(id, 1);
      window.accidente.saldoSangres = saldoSangres;
      return this.actualizarTablaSaldoSangre();
    },
    actualizarTablaSaldoSangre: function() {
      var i, legenda, row, saldo, tabla, tam, that, txt, _i, _j, _len, _len1, _ref, _ref1;
      that = this;
      tabla = $("#tab_saldo_sangre>tbody");
      tabla.empty();
      _ref = window.accidente.saldoSangres;
      for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
        saldo = _ref[i];
        if (saldo) {
          row = "<tr>						<td><a href=\"#editar-sangre\" id=\"borrarSaldo-" + i + "\" class=\"borrarSaldoSangre\"><i class='icon-remove'></i></a>							<a href=\"#editar-sangre\" id=\"actualizarSaldo-" + i + "\" class=\"actualizarSaldoSangre\"><i class='icon-edit'></i></a></td>						<td>" + saldo.nombre + "</td>						<td>" + saldo.edad + "</td>						<td>" + saldo.domicilio + "</td>						<td>" + saldo.se_encontraba + "</td>						<td>" + saldo.estado_herido + "</td>						<td>" + saldo.levantado_por + "</td>						<td>" + saldo.trasladado_a + "</td>						</tr>";
          tabla.append(row);
        }
      }
      _ref1 = window.accidente.saldoSangres;
      for (i = _j = 0, _len1 = _ref1.length; _j < _len1; i = ++_j) {
        saldo = _ref1[i];
        if (saldo) {
          $("#borrarSaldo-" + i).on('click', function(evento) {
            return that.borrarSaldoSangre(evento);
          });
          $("#actualizarSaldo-" + i).on('click', function(evento) {
            var her, id, identificador;
            identificador = evento.currentTarget.id;
            her = identificador.split('-');
            id = her[1];
            return that.sandbox.emit('llenar-saldo-sangre-view', id);
          });
        }
      }
      tam = window.accidente.saldoSangres.length;
      legenda = $("#num_sangres");
      txt = "II Saldo de Sangre" + '(<span class="indicador">' + tam + "</span>)";
      return legenda.html(txt);
    }
  };
});
