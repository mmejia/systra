// Generated by CoffeeScript 1.6.3
define(['core/sandbox'], function(sandbox) {
  var IniciarListaPreliminar;
  return IniciarListaPreliminar = {
    tabla: null,
    isBuscar: true,
    iniciar: function() {
      var that;
      that = this;
      that.iniciarCalendario();
      setModulo('accidente');
      $(".cancelar-preliminar").on('click', function(evento) {
        var id;
        id = evento.currentTarget.id;
        return that.showCancelarPreliminar(id);
      });
      $(".editar-preliminar").on('click', function(evento) {
        var id;
        id = evento.currentTarget.id;
        that.ocultarLista();
        return that.showCaptura(id);
      });
      $("#listaPreliminar_p td").on('click', function(evento) {
        var elemento, id;
        elemento = evento.currentTarget;
        if (elemento.cellIndex > 0) {
          id = $(elemento).parent('tr').attr('id');
          that.ocultarLista();
          return that.showCaptura(id);
        }
      });
      $("#show-search").on('click', function(evento) {
        if (that.isBuscar === true) {
          that.isBuscar = false;
          return that.ocultarBuscar();
        } else {
          that.isBuscar = true;
          return that.mostrarBuscar();
        }
      });
      $('#mostrar-captura-preliminar').on('click', function(evento) {
        alert('Hola mundo');
        that.ocultarLista();
        return that.showAddCaptura();
      });
      return $(".url-nav").on('click', function(evento) {
        var id;
        id = evento.currentTarget.id;
        return that.preDo(id);
      });
    },
    preDo: function(id) {
      $("#page").val(id);
      return $("#form-search-preliminar").submit();
    },
    showAddCaptura: function(fn) {
      var that;
      that = this;
      return $.get('/accidente/soloCapturaPreliminares', function(data) {
        var cambios, el;
        $("#pantalla-lista").html(data);
        $('#mostrar-captura-preliminar').on('click', function(evento) {
          that.ocultarLista();
          return that.showCaptura();
        });
        cambios = {
          width: "98%",
          height: "700px",
          "min-height": "700px",
          margin: "0 10px 0 10px",
          transition: "all 2s ease"
        };
        el = $(".pantalla-captura").css(cambios);
        return fn();
      });
    },
    ocultarLista: function() {
      var cambios, el;
      el = $("#pantalla-lista");
      cambios = {
        height: "0px",
        "min-height": "0px",
        margin: "0 0 0 0",
        padding: "0",
        width: "auto",
        overflow: "hidden",
        transition: "all 2s ease"
      };
      return el.css(cambios);
    },
    llenarComandancias: function() {
      var comandancia, opciones, sel, valor, _i, _len, _ref;
      if (!window.comandancias) {
        cargarComandancias(this.llenarComandancias);
      } else {
        valor = $("#comandancia").val();
        alert(valor);
        sel = $("#comandancia").html("");
        opciones = '<option  value="NO">**SELECCIONAR**</option>';
        _ref = window.comandancias;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          comandancia = _ref[_i];
          if (comandancia.comandancia !== "" && comandancia.comandancia === valor) {
            opciones += '<option value="' + comandancia.comandancia + '" selected="selected">' + comandancia.comandancia + '</option>';
          } else {
            opciones += '<option value="' + comandancia.comandancia + '">' + comandancia.comandancia + '</option>';
          }
        }
        sel.append(opciones);
      }
    },
    ocultarBuscar: function() {
      var cambios, el;
      $("#show-search").html('<i class="icosystra-zoom-in"></i>');
      el = $("#div-search");
      cambios = {
        height: "0px",
        width: "auto",
        margin: "0 0 0 0",
        padding: "0",
        overflow: "hidden",
        transition: "all 2s ease"
      };
      return el.css(cambios);
    },
    mostrarBuscar: function() {
      var cambios, el;
      $("#show-search").html('<i class="icosystra-zoom-out"></i>');
      el = $("#div-search");
      cambios = {
        height: "auto",
        width: "98%",
        margin: "0 10px 0 10px",
        transition: "all 4s ease"
      };
      return el.css(cambios);
    },
    showMensaje: function(titulo, msg) {
      var $div;
      $div = $('#myModal .modal-body').html(msg);
      $("#myModal").modal('show');
      return $('#myModalLabel').html(titulo);
    },
    ocultarCaptura: function() {
      var cambios, el;
      el = $(".pantalla-captura");
      cambios = {
        height: "0px",
        width: "auto",
        margin: "0 0 0 0",
        padding: "0",
        overflow: "hidden",
        transition: "all 2s ease"
      };
      return el.css(cambios);
    },
    ocultarLista: function() {
      var cambios, el;
      el = $("#pantalla-lista");
      cambios = {
        height: "0px",
        margin: "0 0 0 0",
        padding: "0",
        width: "auto",
        overflow: "hidden",
        transition: "all 4s ease"
      };
      return el.css(cambios);
    },
    showCaptura: function(id) {
      var cambios, el;
      $.get('/accidente/soloCapturaPreliminar/' + id + '/', function(data) {
        $(".pantalla-captura").html(data);
        window.cargarSelects(this.loadOnView);
        return $('#mostrar-captura-preliminar').on('click', function() {
          return that.ocultarLista();
        });
      });
      el = $(".pantalla-captura");
      cambios = {
        height: "auto",
        width: "98%",
        margin: "0 10px 0 10px",
        transition: "all 4s ease"
      };
      el.css(cambios);
      return alert('Termino de cargarse');
    },
    showCapturaParte: function(id) {
      var cambios, el;
      $.get('/accidente/captura/' + id + '/', function(data) {
        $(".pantalla-captura").html(data);
        window.cargarSelects(this.loadOnView);
        return $('#mostrar-captura-preliminar').on('click', function() {
          return that.ocultarLista();
        });
      });
      el = $(".pantalla-captura");
      cambios = {
        height: "auto",
        width: "98%",
        margin: "0 10px 0 10px",
        transition: "all 4s ease"
      };
      return el.css(cambios);
    },
    showLista: function() {
      var cambios, el, that;
      that = this;
      cambios = {
        height: "auto",
        width: "98%",
        margin: "0 10px 0 10px",
        transition: "all 4s ease"
      };
      return el = $("#pantalla-lista").css(cambios);
    },
    showCancelarPreliminar: function(id) {
      var that;
      that = this;
      return $.get('/accidente/pantallas/cancelar_preliminar/', function(data) {
        var titulo;
        titulo = "Cancelando folio de preliminar";
        that.showMensaje(titulo, data);
        $('#folio-cancelar-preliminar').html(id);
        return $('#cancelar-folio-preliminar').on('click', function(evento) {
          var causa, dd, id_cabina;
          causa = $('#status-cancelar-preliminar').val();
          id_cabina = $('#folio-cancelar-preliminar').html();
          dd = {
            motivo: causa,
            ident: id_cabina
          };
          return $.post('/accidente/cancelarPreliminar/', dd, function(resultado) {
            return console.log("Se actualizo el ");
          });
        });
      });
    },
    iniciarCalendario: function() {
      $('#fecha-inicia-append').datetimepicker({
        pickTime: false,
        language: 'es'
      });
      return $('#fecha-final-append').datetimepicker({
        pickTime: false,
        language: 'es'
      });
    },
    cargarPreliminares: function() {
      var that;
      that = this;
      return $.ajax({
        type: 'GET',
        url: 'listaPreliminares.json',
        success: function(data) {
          var item, opc, tabla, _i, _len, _results;
          tabla = $("#listaPreliminar_r");
          $("#listaPreliminar_r>tbody").empty();
          opc = '';
          _results = [];
          for (_i = 0, _len = data.length; _i < _len; _i++) {
            item = data[_i];
            opc = '<tr>';
            opc += '<td><a href="#" class="updatePreliminar" id="' + item.id + '"><i class="icon-pencil"></i></a>  ' + '<a href="#" class="viewAccidente" id="' + item.id + '"><i class="icon-eye-open"></i></a></td>';
            opc += '<td>' + item.fecha + '</td>';
            opc += '<td>' + item.folio_evento + '</td>';
            opc += '<td>' + item.agente + '</td>';
            opc += '<td>' + item.lugar + '</td>';
            opc += '</tr>';
            tabla.append(opc);
            _results.push($('#' + item.id).on('click', function(evento) {
              var id;
              console.log(evento.currentTarget.id);
              id = evento.currentTarget.id;
              window.location.href = "cargarPreliminar/" + id + "/";
            }));
          }
          return _results;
        }
      });
    }
  };
});
