// Generated by CoffeeScript 1.6.3
define(['core/sandbox'], function(sandbox) {
  var ManagerTableVehiculos;
  return ManagerTableVehiculos = {
    botonId: '#guardar_vehiculo_parte',
    vehiculos: [],
    elementId: '#tabla_vehiculos_view',
    padreId: "#tab_vehiculos",
    boton: null,
    element: null,
    padre: null,
    template: null,
    ocultarCSS: null,
    mostrarCSS: null,
    iniciar: function() {
      var that;
      that = this;
      this.boton = $(this.botonId);
      this.sandbox = new sandbox(this);
      this.padre = $(this.padreId);
      this.element = $(this.elementId);
      this.sandbox.on('actualizar-tabla-vehiculos', this.actualizarTablaVehiculos);
      this.sandbox.on('show-tabla-vehiculos_c', this.showTablaVehiculos);
      this.sandbox.on('vaciar-tabla-vehiculos', this.vaciarTabla);
      this.sandbox.on('cargar-vehiculos-en-view', this.cargarVehiculosEnView);
      if (window.accidente) {
        this.actualizarTablaVehiculos();
      }
    },
    cargarVehiculosEnView: function() {
      this.actualizarTablaVehiculos();
      this.sandbox.emit('cargar-saldo-sangre-view');
      return this.sandbox.emit('cargar-competencia-judicial-view');
    },
    vaciarTabla: function() {
      var legenda, tabla, txt;
      tabla = $("#tab_vehiculos>tbody");
      tabla.empty();
      legenda = $("#num_vehiculos");
      txt = "I Vehículos y Conductores Involucrados" + ' (<span class="indicador">' + 0 + "</span>)";
      return legenda.html(txt);
    },
    showTablaVehiculos: function() {
      return $('a[href="#pane1"]').tab('show');
    },
    removeVehiculoFromTabla: function(id) {
      var i, index, vehiculo, vehiculos, _i, _len;
      index = -1;
      vehiculos = window.accidente.vehiculos;
      for (i = _i = 0, _len = vehiculos.length; _i < _len; i = ++_i) {
        vehiculo = vehiculos[i];
        if (vehiculo.intervino_como === id) {
          index = i;
          break;
        }
      }
      if (index >= 0) {
        vehiculos.splice(index, 1);
        return this.actualizarTablaVehiculos();
      }
    },
    actualizarTablaVehiculos: function() {
      var legenda, row, tabla, tam, that, txt, vehiculo, _i, _len, _ref;
      that = this;
      tabla = $("#tab_vehiculos>tbody");
      tabla.empty();
      _ref = window.accidente.vehiculos;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        vehiculo = _ref[_i];
        if (vehiculo) {
          row = "<tr>						<td><a href=\"#editar-vehiculo\" id=\"del_" + vehiculo.intervino_como + "\" class=\"vehiculoEliminar\"><span class=\"icosystra-remove\"></span></a>							<a href=\"#editar-vehiculo\" id=\"up_" + vehiculo.intervino_como + "\" class=\"vehiculoActualizar\"><span class=\"icosystra-pencil\"></span></a></td>						<td>" + vehiculo.intervino_como + "</td>						<td>" + vehiculo.placa + "</td>						<td>" + vehiculo.marca + "</td>						<td>" + vehiculo.submarca + "</td>						<td>" + vehiculo.tipo + "</td>						<td>" + vehiculo.modelo + "</td>						<td>" + vehiculo.color + "</td>						</tr>";
          tabla.append(row);
          $('#up_' + vehiculo.intervino_como).on("click", function(evento) {
            var her, id, legenda, tam, txt;
            id = evento.currentTarget.id;
            her = id.split('_');
            that.sandbox.emit('cargar-datos-vehiculo-en-view', her[1]);
            tam = window.accidente.vehiculos.length;
            legenda = $("#num_vehiculos");
            txt = "I Vehículos y Conductores Involucrados" + ' (<span class="indicador">' + tam + "</span>)";
            return legenda.html(txt);
          });
          $('#del_' + vehiculo.intervino_como).on('click', function(evento) {
            var her, id, legenda, tam, txt;
            id = evento.currentTarget.id;
            her = id.split('_');
            that.removeVehiculoFromTabla(her[1]);
            tam = window.accidente.vehiculos.length;
            legenda = $("#num_vehiculos");
            txt = "I Vehículos y Conductores Involucrados" + ' (<span class="indicador">' + tam + "</span>)";
            return legenda.html(txt);
          });
        }
      }
      tam = window.accidente.vehiculos.length;
      legenda = $("#num_vehiculos");
      txt = "I Vehículos y Conductores Involucrados" + ' (<span class="indicador">' + tam + "</span>)";
      return legenda.html(txt);
    },
    mostrarAgregarVehiculo: function() {
      this.sandbox.emit('agregar-vehiculo');
    }
  };
});
