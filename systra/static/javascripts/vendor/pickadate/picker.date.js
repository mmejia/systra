!function(e){"function"==typeof define&&define.amd?define(["picker"],e):e(Picker)}(function(e){function t(e,t){var n=this,r=e.$node[0].value,i=e.$node.data("value"),s=i||r,o=i?t.formatSubmit:t.format;n.settings=t,n.queue={min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"navigate create validate",view:"create validate viewset",disable:"flipItem",enable:"flipItem"},n.item={},n.item.disable=(t.disable||[]).slice(0),n.item.enable=-function(e){return e[0]===!0?e.shift():-1}(n.item.disable),n.set("min",t.min).set("max",t.max).set("now").set("select",s||n.item.now,{format:o,data:function(e){return s&&(e.indexOf("mm")>-1||e.indexOf("m")>-1)}(n.formats.toArray(o))}),n.key={40:7,38:-7,39:1,37:-1,go:function(e){n.set("highlight",[n.item.highlight.year,n.item.highlight.month,n.item.highlight.date+e],{interval:e}),this.render()}},e.on("render",function(){e.$root.find("."+t.klass.selectMonth).on("change",function(){e.set("highlight",[e.get("view").year,this.value,e.get("highlight").date]),e.$root.find("."+t.klass.selectMonth).focus()}),e.$root.find("."+t.klass.selectYear).on("change",function(){e.set("highlight",[this.value,e.get("view").month,e.get("highlight").date]),e.$root.find("."+t.klass.selectYear).focus()})}).on("open",function(){e.$root.find("button, select").attr("disabled",!1)}).on("close",function(){e.$root.find("button, select").attr("disabled",!0)})}var n=7,r=6;t.prototype.set=function(e,t,n){var r=this;return r.item["enable"==e?"disable":"flip"==e?"enable":e]=r.queue[e].split(" ").map(function(i){return t=r[i](e,t,n)}).pop(),"select"==e?r.set("highlight",r.item.select,n):"highlight"==e?r.set("view",r.item.highlight,n):("flip"==e||"min"==e||"max"==e||"disable"==e||"enable"==e)&&r.item.select&&r.item.highlight&&r.set("select",r.item.select,n).set("highlight",r.item.highlight,n),r},t.prototype.get=function(e){return this.item[e]},t.prototype.create=function(t,n,r){var i,s=this;return n=void 0===n?t:n,n==-1/0||1/0==n?i=n:e._.isObject(n)&&e._.isInteger(n.pick)?n=n.obj:$.isArray(n)?(n=new Date(n[0],n[1],n[2]),n=e._.isDate(n)?n:s.create().obj):n=e._.isInteger(n)||e._.isDate(n)?s.normalize(new Date(n),r):s.now(t,n,r),{year:i||n.getFullYear(),month:i||n.getMonth(),date:i||n.getDate(),day:i||n.getDay(),obj:i||n,pick:i||n.getTime()}},t.prototype.now=function(e,t,n){return t=new Date,n&&n.rel&&t.setDate(t.getDate()+n.rel),this.normalize(t,n)},t.prototype.navigate=function(t,n,r){if(e._.isObject(n)){for(var i=new Date(n.year,n.month+(r&&r.nav?r.nav:0),1),s=i.getFullYear(),o=i.getMonth(),u=n.date;e._.isDate(i)&&(new Date(s,o,u)).getMonth()!==o;)u-=1;n=[s,o,u]}return n},t.prototype.normalize=function(e){return e.setHours(0,0,0,0),e},t.prototype.measure=function(t,n){var r=this;return n?e._.isInteger(n)&&(n=r.now(t,n,{rel:n})):n="min"==t?-1/0:1/0,n},t.prototype.viewset=function(e,t){return this.create([t.year,t.month,1])},t.prototype.validate=function(t,n,r){var i,s,o,u,a=this,f=n,l=r&&r.interval?r.interval:1,c=-1===a.item.enable,h=a.item.min,p=a.item.max,d=c&&a.item.disable.filter(function(t){if($.isArray(t)){var r=a.create(t).pick;r<n.pick?i=!0:r>n.pick&&(s=!0)}return e._.isInteger(t)}).length;if(!r.nav&&(!c&&a.disabled(n)||c&&a.disabled(n)&&(d||i||s)||n.pick<=h.pick||n.pick>=p.pick))for(c&&!d&&(!s&&l>0||!i&&0>l)&&(l*=-1);a.disabled(n)&&(Math.abs(l)>1&&(n.month<f.month||n.month>f.month)&&(n=f,l=Math.abs(l)/l),n.pick<=h.pick?(o=!0,l=1):n.pick>=p.pick&&(u=!0,l=-1),!o||!u);)n=a.create([n.year,n.month,n.date+l]);return n},t.prototype.disabled=function(t){var n=this,r=n.item.disable.filter(function(r){return e._.isInteger(r)?t.day===(n.settings.firstDay?r:r-1)%7:$.isArray(r)?t.pick===n.create(r).pick:void 0}).length;return t.pick<n.item.min.pick||t.pick>n.item.max.pick||-1===n.item.enable?!r:r},t.prototype.parse=function(t,n,r){var i=this,s={};if(!n||e._.isInteger(n)||$.isArray(n)||e._.isDate(n)||e._.isObject(n)&&e._.isInteger(n.pick))return n;if(!r||!r.format)throw"Need a formatting option to parse this..";return i.formats.toArray(r.format).map(function(t){var r=i.formats[t],o=r?e._.trigger(r,i,[n,s]):t.replace(/^!/,"").length;r&&(s[t]=n.substr(0,o)),n=n.substr(o)}),[s.yyyy||s.yy,+(s.mm||s.m)-(r.data?1:0),s.dd||s.d]},t.prototype.formats=function(){function t(e,t,n){var r=e.match(/\w+/)[0];return n.mm||n.m||(n.m=t.indexOf(r)),r.length}function n(e){return e.match(/\w+/)[0].length}return{d:function(t,n){return t?e._.digits(t):n.date},dd:function(t,n){return t?2:e._.lead(n.date)},ddd:function(e,t){return e?n(e):this.settings.weekdaysShort[t.day]},dddd:function(e,t){return e?n(e):this.settings.weekdaysFull[t.day]},m:function(t,n){return t?e._.digits(t):n.month+1},mm:function(t,n){return t?2:e._.lead(n.month+1)},mmm:function(e,n){var r=this.settings.monthsShort;return e?t(e,r,n):r[n.month]},mmmm:function(e,n){var r=this.settings.monthsFull;return e?t(e,r,n):r[n.month]},yy:function(e,t){return e?2:(""+t.year).slice(2)},yyyy:function(e,t){return e?4:t.year},toArray:function(e){return e.split(/(d{1,4}|m{1,4}|y{4}|yy|!.)/g)},toString:function(t,n){var r=this;return r.formats.toArray(t).map(function(t){return e._.trigger(r.formats[t],r,[0,n])||t.replace(/^!/,"")}).join("")}}}(),t.prototype.flipItem=function(e,t){var n=this,r=n.item.disable,i=-1===n.item.enable;return"flip"==t?n.item.enable=i?1:-1:!i&&"enable"==e||i&&"disable"==e?r=n.removeDisabled(r,t):(!i&&"disable"==e||i&&"enable"==e)&&(r=n.addDisabled(r,t)),r},t.prototype.addDisabled=function(e,t){var n=this;return t.map(function(t){n.filterDisabled(e,t).length||e.push(t)}),e},t.prototype.removeDisabled=function(e,t){var n=this;return t.map(function(t){e=n.filterDisabled(e,t,1)}),e},t.prototype.filterDisabled=function(e,t,n){var r=$.isArray(t);return e.filter(function(e){var i=!r&&t===e||r&&$.isArray(e)&&t.toString()===e.toString();return n?!i:i})},t.prototype.nodes=function(t){var i=this,s=i.settings,o=i.item.now,u=i.item.select,a=i.item.highlight,f=i.item.view,l=i.item.disable,c=i.item.min,h=i.item.max,p=function(t){return s.firstDay&&t.push(t.shift()),e._.node("thead",e._.group({min:0,max:n-1,i:1,node:"th",item:function(e){return[t[e],s.klass.weekdays]}}))}((s.showWeekdaysFull?s.weekdaysFull:s.weekdaysShort).slice(0)),d=function(t){return e._.node("div"," ",s.klass["nav"+(t?"Next":"Prev")]+(t&&f.year>=h.year&&f.month>=h.month||!t&&f.year<=c.year&&f.month<=c.month?" "+s.klass.navDisabled:""),"data-nav="+(t||-1))},v=function(n){return s.selectMonths?e._.node("select",e._.group({min:0,max:11,i:1,node:"option",item:function(e){return[n[e],0,"value="+e+(f.month==e?" selected":"")+(f.year==c.year&&e<c.month||f.year==h.year&&e>h.month?" disabled":"")]}}),s.klass.selectMonth,t?"":"disabled"):e._.node("div",n[f.month],s.klass.month)},m=function(){var n=f.year,r=s.selectYears===!0?5:~~(s.selectYears/2);if(r){var i=c.year,o=h.year,u=n-r,a=n+r;if(i>u&&(a+=i-u,u=i),a>o){var l=u-i,p=a-o;u-=l>p?p:l,a=o}return e._.node("select",e._.group({min:u,max:a,i:1,node:"option",item:function(e){return[e,0,"value="+e+(n==e?" selected":"")]}}),s.klass.selectYear,t?"":"disabled")}return e._.node("div",n,s.klass.year)};return e._.node("div",d()+d(1)+v(s.showMonthsShort?s.monthsShort:s.monthsFull)+m(),s.klass.header)+e._.node("table",p+e._.node("tbody",e._.group({min:0,max:r-1,i:1,node:"tr",item:function(t){var r=s.firstDay&&0===i.create([f.year,f.month,1]).day?-7:0;return[e._.group({min:n*t-f.day+r+1,max:function(){return this.min+n-1},i:1,node:"td",item:function(t){return t=i.create([f.year,f.month,t+(s.firstDay?1:0)]),[e._.node("div",t.date,function(e){return e.push(f.month==t.month?s.klass.infocus:s.klass.outfocus),o.pick==t.pick&&e.push(s.klass.now),u&&u.pick==t.pick&&e.push(s.klass.selected),a&&a.pick==t.pick&&e.push(s.klass.highlighted),(l&&i.disabled(t)||t.pick<c.pick||t.pick>h.pick)&&e.push(s.klass.disabled),e.join(" ")}([s.klass.day]),"data-pick="+t.pick)]}})]}})),s.klass.table)+e._.node("div",e._.node("button",s.today,s.klass.buttonToday,"data-pick="+o.pick+(t?"":" disabled"))+e._.node("button",s.clear,s.klass.buttonClear,"data-clear=1"+(t?"":" disabled")),s.klass.footer)},t.defaults=function(e){return{monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdaysFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],today:"Today",clear:"Clear",format:"d mmmm, yyyy",klass:{table:e+"table",header:e+"header",navPrev:e+"nav--prev",navNext:e+"nav--next",navDisabled:e+"nav--disabled",month:e+"month",year:e+"year",selectMonth:e+"select--month",selectYear:e+"select--year",weekdays:e+"weekday",day:e+"day",disabled:e+"day--disabled",selected:e+"day--selected",highlighted:e+"day--highlighted",now:e+"day--today",infocus:e+"day--infocus",outfocus:e+"day--outfocus",footer:e+"footer",buttonClear:e+"button--clear",buttonToday:e+"button--today"}}}(e.klasses().picker+"__"),e.extend("pickadate",t)})