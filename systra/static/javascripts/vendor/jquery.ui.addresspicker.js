(function(e,t){e.widget("ui.addresspicker",{options:{appendAddressString:"",draggableMarker:!0,regionBias:null,updateCallback:null,reverseGeocode:!1,mapOptions:{zoom:5,center:new google.maps.LatLng(46,2),scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP},elements:{map:!1,lat:!1,lng:!1,street_number:!1,route:!1,locality:!1,administrative_area_level_2:!1,administrative_area_level_1:!1,country:!1,postal_code:!1,type:!1}},marker:function(){return this.gmarker},map:function(){return this.gmap},updatePosition:function(){this._updatePosition(this.gmarker.getPosition())},reloadPosition:function(){this.gmarker.setVisible(!0),this.gmarker.setPosition(new google.maps.LatLng(this.lat.val(),this.lng.val())),this.gmap.setCenter(this.gmarker.getPosition())},selected:function(){return this.selectedResult},_create:function(){this.geocoder=new google.maps.Geocoder,this.element.autocomplete({source:e.proxy(this._geocode,this),focus:e.proxy(this._focusAddress,this),select:e.proxy(this._selectAddress,this)}),this.lat=e(this.options.elements.lat),this.lng=e(this.options.elements.lng),this.street_number=e(this.options.elements.street_number),this.route=e(this.options.elements.route),this.locality=e(this.options.elements.locality),this.administrative_area_level_2=e(this.options.elements.administrative_area_level_2),this.administrative_area_level_1=e(this.options.elements.administrative_area_level_1),this.country=e(this.options.elements.country),this.postal_code=e(this.options.elements.postal_code),this.type=e(this.options.elements.type),this.options.elements.map&&(this.mapElement=e(this.options.elements.map),this._initMap())},_initMap:function(){this.lat&&this.lat.val()&&(this.options.mapOptions.center=new google.maps.LatLng(this.lat.val(),this.lng.val())),this.gmap=new google.maps.Map(this.mapElement[0],this.options.mapOptions),this.gmarker=new google.maps.Marker({position:this.options.mapOptions.center,map:this.gmap,draggable:this.options.draggableMarker}),google.maps.event.addListener(this.gmarker,"dragend",e.proxy(this._markerMoved,this)),this.gmarker.setVisible(!1)},_updatePosition:function(e){this.lat&&this.lat.val(e.lat()),this.lng&&this.lng.val(e.lng())},_addressParts:{street_number:null,route:null,locality:null,administrative_area_level_2:null,administrative_area_level_1:null,country:null,postal_code:null,type:null},_updateAddressParts:function(e){parsedResult=this._parseGeocodeResult(e);for(addressPart in this._addressParts)this[addressPart]&&this[addressPart].val(parsedResult[addressPart])},_updateAddressPartsViaReverseGeocode:function(t){var n=new google.maps.LatLng(t.lat(),t.lng());this.geocoder.geocode({latLng:n},e.proxy(function(e,t){t==google.maps.GeocoderStatus.OK&&this._updateAddressParts(e[0]),this.element.val(e[0].formatted_address),this.selectedResult=e[0],this.options.updateCallback&&this.options.updateCallback(this.selectedResult,this._parseGeocodeResult(this.selectedResult))},this))},_parseGeocodeResult:function(e){var t={lat:e.geometry.location.lat(),lng:e.geometry.location.lng()};for(var n in this._addressParts)t[n]=this._findInfo(e,n);return t.type=e.types[0],t},_markerMoved:function(){this._updatePosition(this.gmarker.getPosition()),this.options.reverseGeocode&&this._updateAddressPartsViaReverseGeocode(this.gmarker.getPosition())},_geocode:function(e,t){var n=e.term,r=this;this.geocoder.geocode({address:n+this.options.appendAddressString,region:this.options.regionBias},function(e,n){if(n==google.maps.GeocoderStatus.OK)for(var r=0;r<e.length;r++)e[r].label=e[r].formatted_address;t(e)})},_findInfo:function(e,t){for(var n=0;n<e.address_components.length;n++){var r=e.address_components[n];if(r.types.indexOf(t)!=-1)return r.long_name}return!1},_focusAddress:function(e,t){var n=t.item;if(!n)return;this.gmarker&&(this.gmarker.setPosition(n.geometry.location),this.gmarker.setVisible(!0),this.gmap.fitBounds(n.geometry.viewport)),this._updatePosition(n.geometry.location),this._updateAddressParts(n)},_selectAddress:function(e,t){this.selectedResult=t.item,this.options.updateCallback&&this.options.updateCallback(this.selectedResult,this._parseGeocodeResult(this.selectedResult))}}),e.extend(e.ui.addresspicker,{version:"@VERSION"}),Array.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1})})(jQuery)