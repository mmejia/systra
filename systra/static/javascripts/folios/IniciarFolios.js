// Generated by CoffeeScript 1.6.3
define(['core/sandbox'], function(sandbox) {
  var IniciarFolios;
  return IniciarFolios = {
    iniciar: function() {
      var that;
      that = this;
      this.sandbox = new sandbox(this);
      this.llenarProfiles();
      $("#guardar_inf").on('click', function(evento) {
        return that.agregarFolio();
      });
      return $("#btn-agregar-block").on('click', function(evento) {
        return that.showAddBlock();
      });
    },
    agregarFolio: function() {
      var block, currentTime, datos, day, dd, desde, fecha, folio, hasta, month, that, year;
      that = this;
      folio = $('#nom-cobro-agente-inf').val();
      block = $('#block-folio').val();
      desde = $('#desde-folio').val();
      hasta = $('#asta-folio').val();
      currentTime = new Date();
      month = currentTime.getMonth() + 1;
      day = currentTime.getDate();
      year = currentTime.getFullYear();
      fecha = year + "-" + month + "-" + day;
      datos = {
        folio: folio,
        block: block,
        desde: desde,
        hasta: hasta,
        fecha: fecha
      };
      dd = {
        data: JSON.stringify(datos)
      };
      $.post('/folios/add', dd, function(data) {
        var status;
        status = data.status;
        if (status === "OK") {
          that.showMensaje('Se guardo el block <span class="new-folio">' + data.data.no_blocks + '</span> exitosamente!!!');
        } else {
          that.showMensaje(data.msg);
        }
        refrescarTablaBlocks(data.data.num_cobro_agente);
        return that.cancelar();
      });
    },
    showAddBlock: function() {
      var cambios, el;
      el = $("#agregar-block");
      cambios = {
        height: "auto",
        width: "100%"
      };
      return el.css(cambios);
    },
    ocultarAddBlock: function() {
      var cambios, el;
      el = $("#agregar-block");
      cambios = {
        height: "0px",
        width: "0px"
      };
      return el.css(cambios);
    },
    showMensaje: function(msg) {
      var $div;
      $div = $('#myModal .modal-body').html(msg);
      return $("#myModal").modal('show');
    },
    cancelar: function() {
      $('#block-folio').val("");
      $('#desde-folio').val("");
      return $('#asta-folio').val("");
    },
    llenarProfiles: function() {
      var agente, agentes, list_cobro, that, _i, _len;
      that = this;
      if (!window.profiles) {
        cargarProfiles(this.llenarProfiles);
      } else {
        list_cobro = [];
        agentes = window.profiles;
        for (_i = 0, _len = agentes.length; _i < _len; _i++) {
          agente = agentes[_i];
          list_cobro.push(agente.cobro);
        }
        $("#nom-cobro-agente-inf").autocomplete({
          source: list_cobro,
          change: function(evento, ui) {
            var folio, p, _j, _len1, _ref, _results;
            _ref = window.profiles;
            _results = [];
            for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
              p = _ref[_j];
              if (p) {
                if (p.cobro === ui.item.value) {
                  $("#nombre-agente-inf").val(p.nombre);
                  folio = $("#nom-cobro-agente-inf").val();
                  _results.push(refrescarTablaBlocks(folio));
                } else {
                  _results.push(void 0);
                }
              } else {
                _results.push(void 0);
              }
            }
            return _results;
          }
        });
      }
    }
  };
});
