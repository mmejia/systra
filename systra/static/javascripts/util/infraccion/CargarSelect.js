// Generated by CoffeeScript 1.6.3
var iniciarCalendario, llenarArticulos, llenarCalles, llenarCirculaciones, llenarColonias, llenarDelegaciones, llenarFoliosDisponibles, llenarOperativos, llenarProfiles, llenarTurnos;

llenarFoliosDisponibles = function() {
  $.ajax({
    type: 'GET',
    url: '/folios/folios_disponibles',
    success: function(data) {
      var collection, item, _i, _len;
      collection = [];
      for (_i = 0, _len = data.length; _i < _len; _i++) {
        item = data[_i];
        collection.push(item);
      }
      return $("#folio_infraccion").autocomplete({
        source: collection,
        change: function(evento, ui) {
          var p, _j, _len1, _ref, _results;
          _ref = window.profiles;
          _results = [];
          for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
            p = _ref[_j];
            if (p) {
              if (p.cobro === ui.item.folio_agente) {
                $("#nom-cobro-agente-inf").val(p.cobro);
                $("#nombre-agente-inf").val(p.nombre);
                $("#delegacion_spa_inf").val(p.delegacion);
                $("#comandancia_spa_inf").val(p.comandancia);
                _results.push($("#turno_spa_inf").val(p.turno));
              } else {
                _results.push(void 0);
              }
            } else {
              _results.push(void 0);
            }
          }
          return _results;
        }
      });
    }
  });
};

llenarCalles = function() {
  var item, nombres, _i, _len, _ref;
  if (!window.calles) {
    cargarCalles(llenarCalles);
  } else {
    nombres = [];
    _ref = window.calles;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      item = _ref[_i];
      nombres.push(item.calle);
    }
    $("#calle1_spa_inf").autocomplete({
      source: nombres
    });
    $("#calle2_spa_inf").autocomplete({
      source: nombres
    });
  }
};

llenarOperativos = function() {
  var opciones, operativo, sel, _i, _len, _ref;
  if (!window.operativos) {
    cargarOperativos(this.llenarOperativos);
  } else {
    sel = $("#tipo_operativo_spa_inf").html("");
    opciones = '<option  value="NO">**SELECCIONAR**</option>';
    _ref = window.operativos;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      operativo = _ref[_i];
      opciones += '<option value="' + operativo.descripcion + '">' + operativo.descripcion + '</option>';
    }
    sel.append(opciones);
  }
};

llenarCirculaciones = function() {
  var circulacion, opciones, sel, _i, _len, _ref;
  if (!window.circulaciones) {
    cargarCirculaciones(this.llenarCirculaciones);
  } else {
    sel = $("#circulacion_spa_inf").html("");
    opciones = '<option  value="NO">**SELECCIONAR**</option>';
    _ref = window.circulaciones;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      circulacion = _ref[_i];
      opciones += '<option value="' + circulacion.circulacion + '">' + circulacion.circulacion + '</option>';
    }
    sel.append(opciones);
  }
};

llenarArticulos = function() {
  var item, nombres, that, _i, _len, _ref;
  that = this;
  if (!window.articulos) {
    cargarArticulos(llenarArticulos);
  } else {
    nombres = [];
    _ref = window.articulos;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      item = _ref[_i];
      item.toString = function() {
        return this.art + "-" + this.fracc + "-" + this.descc;
      };
      nombres.push({
        value: item
      });
    }
    $("#articulos_spa_inf").autocomplete({
      that: that,
      source: nombres,
      select: function(event, ui) {
        that.currentArticulo = ui.item.value;
      }
    });
  }
};

window.cargarSelects = function(fn) {
  var that;
  that = this;
  that.fn = fn;
  iniciarCalendario();
  if (!window.infraccion) {
    llenarFoliosDisponibles();
    llenarProfiles();
    llenarDelegaciones();
    llenarTurnos();
    llenarColonias();
    llenarCalles();
    llenarOperativos();
    llenarCirculaciones();
    return llenarArticulos();
  } else {
    return $.when($.ajax("/catalogos/delegaciones.json"), $.ajax("/catalogos/comandancias.json"), $.ajax("/catalogos/turnos.json"), $.ajax("/catalogos/colonias.json"), $.ajax("/catalogos/calles.json"), $.ajax("/catalogos/operativos.json"), $.ajax("/catalogos/circulaciones.json")).done(function(delegaciones, comandancias, turnos, colonias, calles, operativos, circulaciones) {
      window.delegaciones = delegaciones[0];
      window.comandancias = comandancias[0];
      window.turnos = turnos[0];
      window.colonias = colonias[0];
      window.calles = calles[0];
      window.operativos = operativos[0];
      window.circulaciones = circulaciones[0];
      llenarProfiles();
      llenarDelegaciones();
      llenarTurnos();
      llenarColonias();
      llenarCalles();
      llenarOperativos();
      llenarCirculaciones();
      llenarArticulos();
      return that.fn.llenarInfraccion();
    });
  }
};

iniciarCalendario = function() {
  $('#fecha-capt-inf').datetimepicker({
    pickTime: false,
    language: 'es'
  });
  return $('#hora-capt-inf').datetimepicker({
    pickDate: false,
    language: 'es'
  });
};

llenarProfiles = function() {
  var agente, agentes, list_cobro, that, _i, _len;
  that = this;
  if (!window.profiles) {
    cargarProfiles(llenarProfiles);
  } else {
    list_cobro = [];
    agentes = window.profiles;
    for (_i = 0, _len = agentes.length; _i < _len; _i++) {
      agente = agentes[_i];
      list_cobro.push(agente.cobro);
    }
    $("#nom-cobro-agente-inf").autocomplete({
      source: list_cobro,
      change: function(evento, ui) {
        var p, _j, _len1, _ref, _results;
        _ref = window.profiles;
        _results = [];
        for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
          p = _ref[_j];
          if (p) {
            if (p.cobro === ui.item.value) {
              $("#nombre-agente-inf").val(p.nombre);
              $("#delegacion_spa_inf").val(p.delegacion);
              $("#comandancia_spa_inf").val(p.comandancia);
              _results.push($("#turno_spa_inf").val(p.turno));
            } else {
              _results.push(void 0);
            }
          } else {
            _results.push(void 0);
          }
        }
        return _results;
      }
    });
  }
};

llenarDelegaciones = function() {
  var delegacion, opciones, sel, _i, _len, _ref;
  if (!window.delegaciones) {
    cargarDelegaciones(llenarDelegaciones);
  } else {
    sel = $("#delegacion_spa_inf").html("");
    opciones = '<option  value="NO">**SELECCIONAR**</option>';
    _ref = window.delegaciones;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      delegacion = _ref[_i];
      opciones += '<option value="' + delegacion.delegacion + '">' + delegacion.delegacion + '</option>';
    }
    sel.append(opciones);
  }
  window.actualizarComandancia();
};

llenarTurnos = function() {
  var opciones, sel, turno, _i, _len, _ref;
  if (!window.turnos) {
    cargarTurnos(llenarTurnos);
  } else {
    sel = $("#turno_spa_inf").html("");
    opciones = '<option  value="NO">**SELECCIONAR**</option>';
    _ref = window.turnos;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      turno = _ref[_i];
      opciones += '<option value="' + turno.turno + '">' + turno.turno + '</option>';
    }
    sel.append(opciones);
  }
};

llenarColonias = function() {
  var item, nombres, _i, _len, _ref;
  if (!window.colonias) {
    cargarColonias(llenarColonias);
  } else {
    nombres = [];
    _ref = window.colonias;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      item = _ref[_i];
      nombres.push(item.nombre);
    }
    $("#colonia_spa_inf").autocomplete({
      source: nombres
    });
  }
};
