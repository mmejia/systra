// Generated by CoffeeScript 1.6.3
define(['jade!/tpl/admin/ListUsers', 'jade!/tpl/admin/AddUser', 'core/sandbox'], function(template, tplAddUser, sandbox) {
  var ManagerListUsers;
  return ManagerListUsers = {
    padreId: "#contenido",
    template: null,
    padre: null,
    tabla: null,
    iniciar: function() {
      var that;
      that = this;
      this.padre = $(this.padreId);
      this.sandbox = new sandbox(this);
      this.template = template;
      this.padre.append(this.template);
      this.tplAddUser = tplAddUser;
      this.tabla = $('#listaUsuarios').dataTable({
        "bJQueryUI": true,
        "sPaginationType": "full_numbers"
      });
      $('#addUsuario').on('click', function() {
        that.padre.html("");
        that.padre.append(that.tplAddUser);
        return $('#guardarUsuario').on('click', function() {
          return that.saveUsuario();
        });
      });
      return this.cargarUsuarios();
    },
    showListUsuarios: function() {
      var that;
      that = this;
      that.padre.html("");
      that.padre.append(that.template);
      this.tabla = $('#listaUsuarios').dataTable({
        "bJQueryUI": true,
        "sPaginationType": "full_numbers"
      });
      this.cargarUsuarios();
      return $('#guardarUsuario').on('click', function() {
        return that.saveUsuario();
      });
    },
    saveUsuario: function() {
      var email, foto, pwd, that, user, usuario;
      that = this;
      usuario = $('#usuario').val();
      pwd = $('#pwd').val();
      email = $('#email').val();
      foto = $('#foto').val();
      user = {
        user: usuario,
        pwd: pwd,
        email: email,
        foto: foto,
        workspace: {
          mensajes: [],
          inventarios: [],
          partes: [],
          preliminares: [],
          infracciones: []
        },
        ubicacion: {
          comandancia: "1era Comandancia",
          sector: "Delegacion",
          delegacion: "Morelos"
        },
        rol: {
          nombre: "1era Comandancia"
        }
      };
      console.log(user);
      return $.post('addUser', user, function(data) {
        return that.showListUsuarios();
      });
    },
    cargarUsuarios: function() {
      var that;
      that = this;
      $.ajax({
        type: 'GET',
        url: 'listUsuarios.json',
        success: function(data) {
          var item, _i, _len;
          for (_i = 0, _len = data.length; _i < _len; _i++) {
            item = data[_i];
            that.tabla.dataTable().fnAddData(["", item.user, item.rol.nombre, item.foto]);
          }
        }
      });
    }
  };
});
